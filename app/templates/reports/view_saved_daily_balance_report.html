{% extends "base.html" %}

{% block title %}View Daily Balance Report{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div>
            <a href="/reports/daily-balance" class="breadcrumb">‚Üê Back to Daily Balance Reports</a>
            <h1>{{ report_data.title }}</h1>
            <p class="date-range">{{ report_data.date_range }}</p>
            {% if report_data.generated_by or report_data.generated_at %}
            <div class="metadata-info">
                {% if report_data.generated_by %}
                <span><strong>Consolidated Report Generated By:</strong> {{ report_data.generated_by }}</span>
                {% endif %}
                {% if report_data.generated_at %}
                <span><strong>Generated At:</strong> {{ report_data.generated_at }}</span>
                {% endif %}
            </div>
            {% endif %}
        </div>
        <a href="/reports/daily-balance/download/{{ year }}/{{ month }}/{{ filename }}" class="btn btn-primary">
            Download CSV
        </a>
    </div>

    {% for daily_report in report_data.daily_reports %}
    <div class="daily-report-section">
        <div class="report-date-header">
            <h2>{{ daily_report.date }} - {{ daily_report.day_of_week }}</h2>
        </div>

        {% if daily_report.created_by or daily_report.finalized_at or daily_report.edited_by %}
        <div class="report-metadata">
            {% if daily_report.created_by %}
            <div><strong>Report Created By:</strong> {{ daily_report.created_by }}</div>
            {% endif %}
            {% if daily_report.finalized_at %}
            <div><strong>Finalized At:</strong> {{ daily_report.finalized_at }}</div>
            {% endif %}
            {% if daily_report.edited_by %}
            <div><strong>Last Edited By:</strong> {{ daily_report.edited_by }}</div>
            {% endif %}
        </div>
        {% endif %}

        {% if daily_report.notes %}
        <div class="report-notes">
            <strong>Notes:</strong> {{ daily_report.notes }}
        </div>
        {% endif %}

        <div class="financial-sections">
            <div class="financial-section">
                <h3>Revenue & Income</h3>
                <table class="financial-table">
                    <tbody>
                        {% for item in daily_report.revenue_items %}
                        <tr>
                            <td>{{ item.name }}</td>
                            <td class="amount">{{ item.value }}</td>
                        </tr>
                        {% endfor %}
                        <tr class="total-row">
                            <td><strong>Total Revenue</strong></td>
                            <td class="amount"><strong>{{ daily_report.revenue_total }}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="financial-section">
                <h3>Deposits & Expenses</h3>
                <table class="financial-table">
                    <tbody>
                        {% for item in daily_report.expense_items %}
                        <tr>
                            <td>{{ item.name }}</td>
                            <td class="amount">{{ item.value }}</td>
                        </tr>
                        {% endfor %}
                        <tr class="total-row">
                            <td><strong>Total Expenses</strong></td>
                            <td class="amount"><strong>{{ daily_report.expense_total }}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="cash-over-under">
            <strong>Cash Over/Under:</strong> <span class="amount">{{ daily_report.cash_over_under }}</span>
        </div>

        {% if daily_report.employees %}
        <div class="employee-section">
            <h3>Employee Breakdown</h3>
            <div class="table-wrapper">
                <table class="employee-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Position</th>
                            <th>Bank Card Sales</th>
                            <th>Bank Card Tips</th>
                            <th>Cash Tips</th>
                            <th>Total Sales</th>
                            <th>Adjustments</th>
                            <th>Tips on Paycheck</th>
                            <th>Tip Out</th>
                            <th>Take Home</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for employee in daily_report.employees %}
                        <tr>
                            <td>{{ employee.name }}</td>
                            <td>{{ employee.position }}</td>
                            <td class="amount">{{ employee.bank_card_sales }}</td>
                            <td class="amount">{{ employee.bank_card_tips }}</td>
                            <td class="amount">{{ employee.cash_tips }}</td>
                            <td class="amount">{{ employee.total_sales }}</td>
                            <td class="amount">{{ employee.adjustments }}</td>
                            <td class="amount">{{ employee.tips_on_paycheck }}</td>
                            <td class="amount">{{ employee.tip_out }}</td>
                            <td class="amount">{{ employee.take_home }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

<style>
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid #e9ecef;
}

.page-header > div {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.breadcrumb {
    color: #3498db;
    text-decoration: none;
    font-size: 0.9rem;
}

.breadcrumb:hover {
    text-decoration: underline;
}

.page-header h1 {
    margin: 0.5rem 0 0.25rem 0;
    color: #2c3e50;
}

.date-range {
    color: #6c757d;
    font-size: 0.95rem;
    margin: 0;
}

.metadata-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-top: 0.5rem;
    padding: 0.75rem;
    background: #f0f9ff;
    border-radius: 6px;
    font-size: 0.9rem;
    color: #495057;
}

.report-metadata {
    background: #f0f9ff;
    padding: 1rem;
    border-radius: 6px;
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
    color: #495057;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.daily-report-section {
    background: white;
    border-radius: 8px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.report-date-header {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #3498db;
}

.report-date-header h2 {
    margin: 0;
    color: #2c3e50;
    font-size: 1.5rem;
}

.report-notes {
    background: #fff8dc;
    padding: 1rem;
    border-radius: 6px;
    margin-bottom: 1.5rem;
    border-left: 4px solid #f0ad4e;
}

.financial-sections {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-bottom: 1.5rem;
}

.financial-section h3 {
    color: #2c3e50;
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1.2rem;
}

.financial-table {
    width: 100%;
    border-collapse: collapse;
}

.financial-table td {
    padding: 0.5rem;
    border-bottom: 1px solid #e9ecef;
}

.financial-table .amount {
    text-align: right;
    font-family: 'Courier New', monospace;
}

.financial-table .total-row {
    background: #f8f9fa;
}

.financial-table .total-row td {
    padding: 0.75rem 0.5rem;
    border-top: 2px solid #dee2e6;
    border-bottom: 2px solid #dee2e6;
}

.cash-over-under {
    background: #e3f2fd;
    padding: 1rem;
    border-radius: 6px;
    margin-bottom: 1.5rem;
    font-size: 1.1rem;
    text-align: center;
}

.cash-over-under .amount {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    color: #1976d2;
}

.employee-section {
    margin-top: 2rem;
}

.employee-section h3 {
    color: #2c3e50;
    margin-bottom: 1rem;
    font-size: 1.2rem;
}

.table-wrapper {
    overflow-x: auto;
}

.employee-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    font-size: 0.9rem;
}

.employee-table thead {
    background: #f8f9fa;
}

.employee-table th {
    padding: 0.75rem 0.5rem;
    text-align: left;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
    color: #495057;
    white-space: nowrap;
}

.employee-table td {
    padding: 0.75rem 0.5rem;
    border-bottom: 1px solid #e9ecef;
}

.employee-table tbody tr:hover {
    background: #f8f9fa;
}

.employee-table .amount {
    text-align: right;
    font-family: 'Courier New', monospace;
}

@media (max-width: 768px) {
    .financial-sections {
        grid-template-columns: 1fr;
    }

    .page-header {
        flex-direction: column;
        gap: 1rem;
    }

    .page-header > div {
        width: 100%;
    }

    .btn {
        width: 100%;
    }
}
</style>
{% endblock %}
