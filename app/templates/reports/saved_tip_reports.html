{% extends "base.html" %}

{% block title %}Saved Tip Reports{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div>
            <a href="/reports/tip-report" class="breadcrumb">‚Üê Back to Tip Reports</a>
            <h1>All Saved Tip Reports</h1>
        </div>
    </div>

    {% if saved_reports %}
    <div class="reports-list">
        {% for report in saved_reports %}
        <div class="report-item">
            <div class="report-item-icon">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
            </div>
            <div class="report-item-info">
                {% if report.start_date and report.end_date %}
                <h3>{{ report.start_date }} to {{ report.end_date }}</h3>
                {% else %}
                <h3>{{ report.filename }}</h3>
                {% endif %}
                <p>Generated {{ report.created_time.strftime('%B %d, %Y at %I:%M %p') }}</p>
                <p class="file-size">File size: {{ (report.file_size / 1024) | round(2) }} KB</p>
            </div>
            <div class="report-item-actions">
                <a href="/reports/tip-report/view/{{ report.year }}/{{ report.month }}/{{ report.filename }}" class="btn btn-primary">View</a>
                <a href="/reports/tip-report/download/{{ report.year }}/{{ report.month }}/{{ report.filename }}" class="btn btn-secondary">Download</a>
                {% if report.is_deletable %}
                <button class="btn btn-danger" onclick="deleteReport('{{ report.year }}', '{{ report.month }}', '{{ report.filename }}')">Delete</button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <p>No saved reports found</p>
        <a href="/reports/tip-report" class="btn btn-primary">Generate a Report</a>
    </div>
    {% endif %}
</div>

<style>
.page-header {
    margin-bottom: 2rem;
}

.page-header > div {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.breadcrumb {
    color: #3498db;
    text-decoration: none;
    font-size: 0.9rem;
}

.breadcrumb:hover {
    text-decoration: underline;
}

.reports-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.report-item {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: box-shadow 0.2s;
}

.report-item:hover {
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.report-item-icon {
    flex-shrink: 0;
    width: 48px;
    height: 48px;
    background: #e3f2fd;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #1976d2;
}

.report-item-info {
    flex: 1;
    min-width: 0;
}

.report-item-info h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.125rem;
    color: #2c3e50;
}

.report-item-info p {
    margin: 0.25rem 0;
    font-size: 0.875rem;
    color: #6c757d;
}

.file-size {
    color: #95a5a6;
    font-size: 0.8rem;
}

.report-item-actions {
    display: flex;
    gap: 0.75rem;
}

.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: #f8f9fa;
    border-radius: 8px;
}

.empty-state p {
    color: #6c757d;
    font-size: 1.1rem;
    margin-bottom: 1.5rem;
}

@media (max-width: 768px) {
    .report-item {
        flex-direction: column;
        text-align: center;
    }

    .report-item-actions {
        width: 100%;
        flex-direction: column;
    }

    .report-item-actions .btn {
        width: 100%;
    }
}

.btn-danger {
    background-color: #e74c3c;
    color: white;
    border: none;
}

.btn-danger:hover {
    background-color: #c0392b;
}
</style>

<script>
async function deleteReport(year, month, filename) {
    if (!confirm(`Are you sure you want to delete this report?\n\n${filename}`)) {
        return;
    }

    try {
        const response = await fetch(`/reports/tip-report/delete/${year}/${month}/${filename}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const data = await response.json();

        if (data.success) {
            alert('Report deleted successfully');
            window.location.reload();
        } else {
            alert(`Failed to delete report: ${data.message}`);
        }
    } catch (error) {
        alert(`Error deleting report: ${error.message}`);
    }
}
</script>
{% endblock %}
