{% extends "base.html" %}

{% block title %}View Tip Report{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div>
            <a href="/reports/tip-report" class="breadcrumb">‚Üê Back to Tip Reports</a>
            <h1>{{ report_data.title }}</h1>
            <p class="date-range">{{ report_data.date_range }}</p>
            {% if report_data.generated_by or report_data.generated_at %}
            <div class="metadata-info">
                {% if report_data.generated_by %}
                <span><strong>Generated By:</strong> {{ report_data.generated_by }}</span>
                {% endif %}
                {% if report_data.generated_at %}
                <span><strong>Generated At:</strong> {{ report_data.generated_at }}</span>
                {% endif %}
            </div>
            {% endif %}
        </div>
        <a href="/reports/tip-report/download/{{ year }}/{{ month }}/{{ filename }}" class="btn btn-primary">
            Download CSV
        </a>
    </div>

    {% if report_data.payroll_summary and report_data.payroll_summary|length > 0 %}
    <div class="report-section">
        <h2>Payroll Summary</h2>
        <div class="table-wrapper">
            {% if report_data.is_employee_specific %}
            {% for payroll_entry in report_data.payroll_summary %}
            <h3 style="margin: 1rem 0 0.5rem 0; padding: 0.5rem 1rem; background: #e3f2fd; border-radius: 4px;">{{ payroll_entry.position }}</h3>
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                    {% for field in payroll_entry.fields %}
                    <tr>
                        <td class="employee-name">{{ field.name }}</td>
                        <td class="amount">{{ field.value }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endfor %}
            {% else %}
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>Employee Name</th>
                        <th>Position</th>
                        {% if report_data.payroll_summary[0].fields %}
                            {% for field in report_data.payroll_summary[0].fields %}
                            <th>{{ field.name }}</th>
                            {% endfor %}
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for employee in report_data.payroll_summary %}
                    <tr>
                        <td class="employee-name">{{ employee.employee_name }}</td>
                        <td>{{ employee.position }}</td>
                        {% for field in employee.fields %}
                        <td class="amount">{{ field.value }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                    {% if report_data.payroll_summary_totals %}
                    <tr class="totals-row">
                        <td colspan="2"><strong>TOTAL</strong></td>
                        {% for total in report_data.payroll_summary_totals %}
                        <td class="amount"><strong>{{ total.value }}</strong></td>
                        {% endfor %}
                    </tr>
                    {% endif %}
                </tbody>
            </table>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% if report_data.summary and report_data.summary|length > 0 %}
    <div class="report-section">
        <h2>Employee Summary</h2>
        <div class="table-wrapper">
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>Employee Name</th>
                        <th>Position</th>
                        {% if report_data.summary[0].fields %}
                            {% for field in report_data.summary[0].fields %}
                            <th>{{ field.name }}</th>
                            {% endfor %}
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for employee in report_data.summary %}
                    <tr>
                        <td class="employee-name">{{ employee.employee_name }}</td>
                        <td>{{ employee.position }}</td>
                        {% for field in employee.fields %}
                        <td class="amount">{{ field.value }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="empty-state">
        <p>No summary data found in this report</p>
    </div>
    {% endif %}

    {% if report_data.details %}
    <div class="report-section">
        <h2>Detailed Breakdown</h2>
        {% for employee_detail in report_data.details %}
        <div class="employee-detail">
            <h3>{{ employee_detail.employee }}</h3>
            <div class="table-wrapper">
                <table class="detail-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Day</th>
                            {% if employee_detail.entries and employee_detail.entries|length > 0 %}
                                {% for field in employee_detail.entries[0].fields %}
                                <th>{{ field.name }}</th>
                                {% endfor %}
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in employee_detail.entries %}
                        <tr>
                            <td>{{ entry.date }}</td>
                            <td>{{ entry.day }}</td>
                            {% for field in entry.fields %}
                            <td class="amount">{{ field.value }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<style>
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #e9ecef;
}

.page-header > div {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.breadcrumb {
    color: #3498db;
    text-decoration: none;
    font-size: 0.9rem;
}

.breadcrumb:hover {
    text-decoration: underline;
}

.date-range {
    color: #6c757d;
    font-size: 1rem;
    margin: 0;
}

.metadata-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-top: 0.5rem;
    padding: 0.75rem;
    background: #f0f9ff;
    border-radius: 6px;
    font-size: 0.9rem;
    color: #495057;
}

.report-section {
    margin-bottom: 3rem;
}

.report-section h2 {
    margin-bottom: 1.5rem;
    color: #2c3e50;
    font-size: 1.5rem;
}

.table-wrapper {
    overflow-x: auto;
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.summary-table,
.detail-table {
    width: 100%;
    border-collapse: collapse;
}

.summary-table thead,
.detail-table thead {
    background: #f8f9fa;
}

.summary-table th,
.summary-table td,
.detail-table th,
.detail-table td {
    padding: 0.75rem 1rem;
    text-align: left;
    border-bottom: 1px solid #e9ecef;
}

.summary-table th,
.detail-table th {
    font-weight: 600;
    color: #495057;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.summary-table tbody tr:hover,
.detail-table tbody tr:hover {
    background: #f8f9fa;
}

.summary-table tbody tr:last-child td,
.detail-table tbody tr:last-child td {
    border-bottom: none;
}

.totals-row {
    background: #f8f9fa;
    border-top: 2px solid #495057 !important;
}

.totals-row td {
    padding: 0.75rem 1rem;
    font-weight: 600;
    color: #2c3e50;
    border-top: 2px solid #495057;
    border-bottom: 2px solid #495057;
}

.employee-name {
    font-weight: 500;
    color: #2c3e50;
}

.amount {
    text-align: right;
    font-family: 'Monaco', 'Courier New', monospace;
    font-size: 0.9rem;
}

.highlight {
    font-weight: 600;
    color: #27ae60;
}

.center {
    text-align: center;
}

.empty-state {
    text-align: center;
    padding: 3rem;
    background: #f8f9fa;
    border-radius: 8px;
    margin: 2rem 0;
}

.empty-state p {
    color: #6c757d;
    font-size: 1.1rem;
}

.employee-detail {
    margin-bottom: 2rem;
}

.employee-detail h3 {
    margin-bottom: 1rem;
    color: #2c3e50;
    font-size: 1.25rem;
    padding: 0.75rem 1rem;
    background: #e3f2fd;
    border-radius: 6px;
}

@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        gap: 1rem;
    }

    .page-header .btn {
        width: 100%;
    }

    .summary-table th,
    .summary-table td,
    .detail-table th,
    .detail-table td {
        padding: 0.5rem;
        font-size: 0.875rem;
    }
}
</style>
{% endblock %}
